# Villagers Reborn Configuration

Location:
- File path: config/villagersreborn.json (created automatically on first run if missing)
- Loaded by the game at startup via ConfigManager.loadConfig()

Editing:
- Edit config/villagersreborn.json and restart (or use in-game toggles where available).
- Invalid or out-of-range values fall back to defaults; warnings are logged.
- Comments are not allowed by JSON. The generated file includes a string key "//" as a note.

Environment variables:
- LLM API key must be provided via environment variable VILLAGERS_REBORN_API_KEY. The JSON contains "llmApiKey" as a placeholder for user clarity but is not read by the system.
- Other fields are read from the JSON file; no additional env var overrides are implemented.

Default values and validation come from:
- [`src/main/java/com/beeny/config/VillagersRebornConfig.java`](src/main/java/com/beeny/config/VillagersRebornConfig.java)
- Applied/validated by [`src/main/java/com/beeny/config/ConfigManager.java`](src/main/java/com/beeny/config/ConfigManager.java)

Below is the authoritative list of fields, with types, defaults, and validation rules enforced by ConfigManager.applyConfig().

General scanning
- villagerScanChunkRadius
  - Type: integer
  - Default: 8
  - Range: 0..64 inclusive
  - Description: Radius in chunks for scanning areas relevant to villagers. 1 chunk = 16 blocks. Effective scan box size = villagerScanChunkRadius × 16 blocks.

Happiness system
- happinessNeutralThreshold
  - Type: integer
  - Default: 50
  - Range: 0..100 inclusive
  - Description: Value at which villagers are considered neutral on a 0–100 scale.
- happinessDecayRate
  - Type: integer
  - Default: 1
  - Range: 0..Integer.MAX_VALUE
  - Description: Decrease per update interval when conditions are unfavorable.
- happinessRecoveryRate
  - Type: integer
  - Default: 1
  - Range: 0..Integer.MAX_VALUE
  - Description: Increase per update interval when recovering.

Dialogue and LLM
- enableDynamicDialogue
  - Type: boolean
  - Default: true
  - Validation: Must be a JSON boolean; otherwise falls back to default.
  - Description: Enables LLM-powered dialogue. If false, static dialogue is used.
- llmProvider
  - Type: string
  - Default: "gemini"
  - Allowed values: "gemini", "openrouter", "local" (case-insensitive; stored canonically)
  - Description: Selects which LLM provider to use.
- llmApiEndpoint
  - Type: string
  - Default: "" (blank)
  - Validation: string (no allowed-list restriction)
  - Description: Overrides API base endpoint for the selected provider (e.g., "https://api.openrouter.ai/v1"). Optional.
- llmModel
  - Type: string
  - Default: "" (blank)
  - Validation: string (no allowed-list restriction)
  - Description: Model identifier for the selected provider (e.g., "gemini-1.5-flash", "openrouter/some-model", or local model id). Optional.
- llmTemperature
  - Type: number (double)
  - Default: 0.7
  - Range: 0.0..2.0 inclusive
  - Description: Sampling temperature controlling creativity vs determinism.
- llmMaxTokens
  - Type: integer
  - Default: 150
  - Range: 1..1_000_000 inclusive
  - Description: Maximum tokens generated by the LLM per response.
- llmRequestTimeout
  - Type: integer (milliseconds)
  - Default: 10000
  - Range: 100..3_600_000 inclusive
  - Description: Timeout for LLM requests.
- fallbackToStatic
  - Type: boolean
  - Default: true
  - Description: Fall back to static dialogue if LLM is disabled or fails.
- enableDialogueCache
  - Type: boolean
  - Default: true
  - Description: Enables caching of dialogue responses to reduce repeated LLM calls.
- dialogueCacheSize
  - Type: integer
  - Default: 1000
  - Range: 0..Integer.MAX_VALUE
  - Description: Max number of cached dialogue entries.
- conversationHistoryLimit
  - Type: integer
  - Default: 10
  - Range: 0..10_000
  - Description: Number of recent conversation exchanges preserved per villager.
- maxExperienceHistory
  - Type: integer
  - Default: 200
  - Range: 0..Integer.MAX_VALUE
  - Description: Maximum number of past experiences stored per villager for learning/recall. Higher values may increase memory usage.
- llmLocalUrl
  - Type: string
  - Default: "http://localhost:8080"
  - Description: Base URL for a locally hosted LLM service when llmProvider is "local".

AI subsystem intervals
- aiEmotionUpdateInterval
  - Type: integer (milliseconds)
  - Default: 60000
  - Range: 50..Integer.MAX_VALUE
  - Description: Update interval for the emotion system.
- aiManagerUpdateInterval
  - Type: integer (milliseconds)
  - Default: 5000
  - Range: 1..Integer.MAX_VALUE
  - Description: Update interval for the AI manager state system.
- aiGoapUpdateInterval
  - Type: integer (milliseconds)
  - Default: 3000
  - Range: 1..Integer.MAX_VALUE
  - Description: Update interval for the GOAP planning system.

Interaction/misc
- marriagePacketCooldown
  - Type: integer (milliseconds)
  - Default: 5000
  - Range: 0..Integer.MAX_VALUE
  - Description: Cooldown for villager marriage proposals.

Additional notes
- Bounding box helper: VillagersRebornConfig.getBoundingBoxSize() = villagerScanChunkRadius × 16 blocks.
- Thread pool size (AI_THREAD_POOL_SIZE = 4) and other static fields in VillagersRebornConfig.java are not currently read from the JSON file and thus are not configurable via villagersreborn.json.

Example JSON (with defaults)
{
  "//": "Set your API key via environment variable VILLAGERS_REBORN_API_KEY",
  "villagerScanChunkRadius": 8,
  "happinessNeutralThreshold": 50,
  "happinessDecayRate": 1,
  "happinessRecoveryRate": 1,
  "enableDynamicDialogue": true,
  "llmProvider": "gemini",
  "llmApiKey": "",
  "llmApiEndpoint": "",
  "llmModel": "",
  "llmTemperature": 0.7,
  "llmMaxTokens": 150,
  "llmRequestTimeout": 10000,
  "fallbackToStatic": true,
  "enableDialogueCache": true,
  "dialogueCacheSize": 1000,
  "conversationHistoryLimit": 10,
  "maxExperienceHistory": 200,
  "llmLocalUrl": "http://localhost:8080",
  "aiEmotionUpdateInterval": 60000,
  "aiManagerUpdateInterval": 5000,
  "aiGoapUpdateInterval": 3000,
  "marriagePacketCooldown": 5000
}

How to set the API key
- Linux/macOS:
  - export VILLAGERS_REBORN_API_KEY="your-key"
- Windows (PowerShell):
  - $Env:VILLAGERS_REBORN_API_KEY="your-key"
- The key is read by dialogue provider code; the JSON "llmApiKey" field is a placeholder and is not read.

Validation behavior
- If a field is missing, invalid type, or out of allowed range, the system logs a warning and keeps the in-memory default (from VillagersRebornConfig).
- Allowed-list normalization: llmProvider is normalized to exactly "gemini", "openrouter", or "local" based on case-insensitive match.

Saving changes in-game
- Some commands toggle fields (e.g., /villager ai toggle). When applicable, the system may call ConfigManager.saveConfig() to persist changes to config/villagersreborn.json.

See also
- Backups and data export: [`docs/BACKUP.md`](docs/BACKUP.md)